# netlify.toml

[build]
  command = "pip install -r requirements.txt && npm run build"
  publish = "dist"                         # Carpeta de salida del build (vite build)
  functions = "netlify/functions"          # Directorio donde están tus serverless functions

[dev]
  framework = "vite"                       # Asegura que Netlify detecte y use Vite para dev server
  command = "npm run dev"
  targetPort = 5173                        # Puerto donde corre Vite normalmente
  port = 8888                              # Puerto donde correrá netlify dev (frontend + backend)
  autoLaunch = true                        # Abre automáticamente en el navegador

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[functions]
  node_bundler = "esbuild"
  external_node_modules = ["openai", "pdfjs-dist"]
  included_files = [
    "node_modules/pdfjs-dist/legacy/build/pdf.worker.js",
    "node_modules/pdfjs-dist/legacy/build/pdf.js"
  ]

[build.environment]
  PYTHON_VERSION = "3.10"
  PIP_NO_CACHE_DIR = "off"
  PIP_DISABLE_PIP_VERSION_CHECK = "1"
